import requests
import pandas as pd
from datetime import datetime
import time

# Define cities and your OpenWeatherMap API key
cities = ['Bhopal', 'Indore', 'Jabalpur']
api_key = 'e8aa8ff928f9028b27294ce00aa89c80' 

# Function to fetch weather data
def fetch_weather_data(city):
    url = f"https://api.openweathermap.org/data/2.5/forecast?q={city}&appid={api_key}&units=metric"
    response = requests.get(url)
    return response.json()

# Function to process and save data
def process_and_save_data():
    all_data = []
    for city in cities:
        data = fetch_weather_data(city)
        for entry in data['list']:
            all_data.append({
                'City': city,
                'Date & Time': entry['dt_txt'],
                'Temperature (Â°C)': entry['main']['temp'],
                'Weather': entry['weather'][0]['description'],
                'Humidity (%)': entry['main']['humidity'],
                'Wind Speed (m/s)': entry['wind']['speed'],
                'Timestamp': datetime.utcnow()
            })
    df = pd.DataFrame(all_data)
    df.to_csv('weather_data.csv', mode='a', header=False, index=False)

# Main loop to run the script every 3 hours
while True:
    process_and_save_data()
    print(f"Data fetched and saved at {datetime.utcnow()}")
    time.sleep(10800)  # Sleep for 3 hours (10800 seconds)
    
    
